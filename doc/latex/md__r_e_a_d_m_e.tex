A Micro Key/\+Value Store with Query Support.

\subsection*{Features}


\begin{DoxyItemize}
\item Small
\item Fast
\item Memory \hyperlink{struct_storage}{Storage}
\item Disk \hyperlink{struct_storage}{Storage} (coming soon)
\item Querying of Data (in progress)
\item Native J\+S\+O\+N Support (in progress)
\end{DoxyItemize}

\subsection*{Platforms}

The following platforms are being targeted\+:
\begin{DoxyItemize}
\item Linux (X86\+\_\+64, A\+R\+M, M\+I\+P\+S)
\item O\+S\+X -\/ development
\item Arduino
\item E\+S\+P8266
\end{DoxyItemize}

\subsection*{Development Goals}

As small devices become both more powerful and less expensive, it starts to make sense to move processing and storage toward the edge. Having a micro database available where sensors and data exist adds a lot of flexibility and power to tiny devices.

Among these are to make devices be able to be queried for some historic data in one operating mode, but also to allow a device to remain disconnected from a network for a longer period of time, allowing for a device to remain in a lower power state at the expense of less up to date data.

\subsubsection*{T\+O\+D\+O (Lots)}


\begin{DoxyItemize}
\item Speed optimized memory storage
\item Indexing
\item Builds
\end{DoxyItemize}

\subsection*{Usage and Development}

This project is in rapid development, but attempts to be well tested.

All attempts will be made to follow S\+E\+M\+V\+E\+R versioning requirements.

\subsubsection*{Compiling}

Running {\ttfamily make} should be enough to get tests built and run\+:


\begin{DoxyCode}
1 $ make
2 cc -c -I./src -Wall -g test/test.c -o test/test.o
3 cc -c -I./src -Wall -g test/memory.c -o test/memory.o
4 cc -c -I./src -Wall -g src/emdb.c -o obj/emdb.o
5 cc -c -I./src -Wall -g src/storage/memory.c -o obj/storage/memory.o
6 cc -g test/test.o test/memory.o obj/emdb.o obj/storage/memory.o -o test\_runner
7 ./test\_runner --spec
8 
9 test memory storage
10   ✓ entry is null after read
11   ✓ write succeeded
12   ✓ entry size is 4
13   ✓ entry is correct
14   ✓ memory usage is correctly reported
15   ✓ second write succeeded
16   ✓ entry size is 4
17   ✓ entry is correct
18   ✓ entry is null after delete called
19   ✓ memory usage is correctly reported
20 
21 test context isolation
22   ✓ write to context 1 succeeded
23   ✓ entry size is 4
24   ✓ entry is correct
25   ✓ memory usage is correctly reported for context 1
26   ✓ memory usage is correctly reported for context 2
27   ✓ entry is null after read on context 2
28   ✓ second write to context 1 succeeded
29   ✓ entry size is 4
30   ✓ entry is correct
31   ✓ entry is null after read on context 2
32   ✓ entry is null after delete called
33   ✓ memory usage is correctly reported
34 
35 test emdb
36   ✓ database is created
37   ✓ entry is null after read
38   ✓ write is successful
39   ✓ entry size is 4
40   ✓ entry is correct
41 
42 PASSED: 27
43 FAILED: 0
\end{DoxyCode}


\subsubsection*{Using}

Currently, you must include the {\ttfamily .o} files that you wish to use in your linking stage.

There is only one backing store available\+: {\ttfamily Memory\+Storage}. This is a reference implementation that is being used to prove out the platform as a viable engine.

\paragraph*{Example Program}

This is a quick example of interfacing with the database.


\begin{DoxyCode}
\textcolor{preprocessor}{#include <stdio.h>}

\textcolor{preprocessor}{#include "storage/memory.h"}
\textcolor{preprocessor}{#include "\hyperlink{emdb_8h}{emdb.h}"}


\textcolor{keywordtype}{int} main ( ) \{
  \hyperlink{struct_e_m_d_b}{EMDB} *db;
  \hyperlink{struct_entry}{Entry} *entry;

  db = \hyperlink{emdb_8h_ac1037445305c87293222d8f1ffc09a35}{emdb\_create\_db}(&MemoryStorage, 1024, NULL);

  \hyperlink{emdb_8h_a06ad05c842c7e71fdd3d9fcda104468c}{emdb\_write}(db, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)\textcolor{stringliteral}{"key"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)\textcolor{stringliteral}{"value"}, 6);
  entry = \hyperlink{emdb_8h_ad7c955b5b8b45d49ffd591b18e285304}{emdb\_read}(db, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)\textcolor{stringliteral}{"key"});

  printf(\textcolor{stringliteral}{"found entry: %s\(\backslash\)n"}, (\textcolor{keywordtype}{char} *)entry->\hyperlink{struct_entry_aa88c7d1c3b4c4e69ea46dc9559224dc1}{ptr});

  \hyperlink{emdb_8h_a8fd691da056962b197364ac167e0d421}{emdb\_free\_entry}(entry);

  \hyperlink{emdb_8h_a0de03f227038828bdacbab4c93a07ddb}{emdb\_destroy\_db}(db);

  \textcolor{keywordflow}{return} 1;
\}
\end{DoxyCode}


\paragraph*{A\+P\+I}

\subparagraph*{Creating a Database}

Creates a database, as well as the context that it uses.

{\ttfamily \hyperlink{struct_e_m_d_b}{E\+M\+D\+B} $\ast$emdb\+\_\+create\+\_\+db(\hyperlink{struct_storage}{Storage}, max\+\_\+memory, options)}

{\itshape Returns\+:} {\ttfamily \hyperlink{struct_e_m_d_b}{E\+M\+D\+B} $\ast$} on success, {\ttfamily N\+U\+L\+L} on error


\begin{DoxyCode}
\hyperlink{struct_e_m_d_b}{EMDB} *db = \hyperlink{emdb_8h_ac1037445305c87293222d8f1ffc09a35}{emdb\_create\_db}(&MemoryStorage, 1024, NULL);
\end{DoxyCode}


\subparagraph*{Writing an \hyperlink{struct_entry}{Entry}}

Writes a value to the database. This will overwrite any existing entry.

{\ttfamily unsigned char ret = emdb\+\_\+write(\+E\+M\+D\+B $\ast$, unsigned char $\ast$, unsigned char $\ast$, size)}

{\itshape Returns\+:} {\ttfamily 1} on success, {\ttfamily 0} on error


\begin{DoxyCode}
\hyperlink{emdb_8h_a06ad05c842c7e71fdd3d9fcda104468c}{emdb\_write}(db, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) \textcolor{stringliteral}{"key"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) \textcolor{stringliteral}{"value"}, 6);
\end{DoxyCode}


\subparagraph*{Reading an \hyperlink{struct_entry}{Entry}}

Reads an entry from the database.

{\ttfamily \hyperlink{struct_entry}{Entry} $\ast$emdb\+\_\+read(\hyperlink{struct_e_m_d_b}{E\+M\+D\+B} $\ast$, unsigned char $\ast$)}

{\itshape Returns\+:} {\ttfamily \hyperlink{struct_entry}{Entry} $\ast$} on success, {\ttfamily N\+U\+L\+L} on error


\begin{DoxyCode}
\hyperlink{struct_entry}{Entry} *entry = \hyperlink{emdb_8h_ad7c955b5b8b45d49ffd591b18e285304}{emdb\_read}(db, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) \textcolor{stringliteral}{"key"});

printf(\textcolor{stringliteral}{"value: %s\(\backslash\)n"}, (\textcolor{keywordtype}{char} *) entry->\hyperlink{struct_entry_aa88c7d1c3b4c4e69ea46dc9559224dc1}{ptr});

\hyperlink{emdb_8h_a8fd691da056962b197364ac167e0d421}{emdb\_free\_entry}(entry);
\end{DoxyCode}


\subparagraph*{Deleting an \hyperlink{struct_entry}{Entry}}

Deletes and entry from the database.

{\ttfamily unsigned char \hyperlink{emdb_8h_ad3579dc6616286a680dfff12e591979e}{emdb\+\_\+delete(\+E\+M\+D\+B $\ast$, unsigned char $\ast$)}}

{\itshape Returns\+:} {\ttfamily 1} on success, {\ttfamily 0} on error


\begin{DoxyCode}
\hyperlink{emdb_8h_ad3579dc6616286a680dfff12e591979e}{emdb\_delete}(db, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *) \textcolor{stringliteral}{"key"});
\end{DoxyCode}


\subparagraph*{Closing a Database}

Closes a database and frees any resources that are open.

{\ttfamily void emdb\+\_\+destroy(db)}


\begin{DoxyCode}
emdb\_destroy(db);
\end{DoxyCode}


\subparagraph*{Errors}

Returns the text of the last known error.

{\ttfamily char $\ast$emdb\+\_\+last\+\_\+error(\hyperlink{struct_e_m_d_b}{E\+M\+D\+B} $\ast$)}

{\itshape Returns\+:} Last error thrown


\begin{DoxyCode}
printf(\textcolor{stringliteral}{"ERROR: %s\(\backslash\)n"}, \hyperlink{emdb_8h_a1b220438f7af65ca90c860b495a3cd78}{emdb\_last\_error}(db));
\end{DoxyCode}
 